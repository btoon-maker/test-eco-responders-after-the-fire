<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eco-Responders: After the Fire (Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; background: #f5f7f6; line-height: 1.6; }
    header { background:#2f5d50; color:#fff; padding: 1.25rem; }
    main { max-width: 980px; margin: 0 auto; background: #fff; padding: 1.5rem; }

    h1,h2,h3 { margin-top: 0; color:#1f3b34; }
    .small { font-size: 0.92rem; color:#455; }
    .pill { display:inline-block; padding: 0.15rem 0.55rem; border-radius: 999px; background:#dfece7; color:#2f5d50; font-size: 0.85rem; }

    .card {
      background:#eef5f2;
      border-left: 5px solid #2f5d50;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 12px;
    }

    .row { display:flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 0.75rem; align-items: center; }

    .btn {
      background:#2f5d50; color:#fff; border:none; padding:0.6rem 1rem; border-radius:10px; cursor:pointer;
      font-size:1rem;
    }
    .btn.secondary { background:#405a53; }
    .btn.ghost { background: transparent; border: 1px solid #2f5d50; color:#2f5d50; }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 0.75rem;
      border-radius: 12px;
      border: 1px solid #cfd8d5;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .hidden { display: none; }
    .divider { border: none; border-top: 1px solid #e6ece9; margin: 1.25rem 0; }

    /* Layout helpers */
    .split { display: grid; grid-template-columns: 1fr; gap: 1rem; align-items: start; }
    @media (min-width: 860px) { .split { grid-template-columns: 1.15fr 0.85fr; } }

    .placeholder {
      border: 2px dashed #cfd8d5;
      background: #fafcfc;
      border-radius: 14px;
      min-height: 220px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#667;
      padding: 1rem;
      text-align:center;
    }

    details {
      background:#fafcfc;
      border: 1px solid #e6ece9;
      border-radius: 12px;
      padding: 0.75rem 0.9rem;
      margin: 0.75rem 0;
    }
    details summary { cursor:pointer; font-weight: 700; color:#1f3b34; }

    /* ---------- SMALL TOP-RIGHT PANEL ---------- */
    .savePanel {
      position: fixed;
      top: 12px;
      right: 12px;
      width: 260px;
      max-width: calc(100vw - 24px);
      background: #2c3e50;
      color: #fff;
      border-radius: 14px;
      padding: 10px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
      z-index: 9999;
      font-size: 0.85rem;
    }
    .savePanel h4 { margin: 0 0 6px 0; font-size: 0.95rem; }
    .savePanel label { display:block; margin-top: 8px; opacity: 0.9; }
    .savePanel input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.22);
      padding: 8px 10px;
      font-size: 0.9rem;
      box-sizing: border-box;
      margin-top: 4px;
      background: rgba(255,255,255,0.10);
      color: #fff;
    }
    .savePanel input::placeholder { color: rgba(255,255,255,0.65); }

    .savePanel .miniRow { display:flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
    .savePanel .miniBtn {
      border: none;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.88rem;
      cursor: pointer;
      background: #16a085;
      color: #fff;
      flex: 1 1 auto;
    }
    .savePanel .miniBtn.secondary { background: rgba(255,255,255,0.18); }
    .savePanel .miniBtn.ghost { background: transparent; border: 1px solid rgba(255,255,255,0.45); }
    .savePanel .status { margin-top: 6px; opacity: 0.9; white-space: pre-wrap; }

    /* ---------- CENTER MODAL (POP-OUT) ---------- */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 16px;
    }
    .overlay.show { display: flex; }

    .modal {
      width: min(720px, 96vw);
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.25);
      border: 1px solid #e6ece9;
    }
    .modal h2 { margin: 0 0 6px; color:#1f3b34; }
    .modal .modalSmall { color:#556; font-size: 0.92rem; margin: 0 0 10px; }

    .modalGrid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 760px){ .modalGrid { grid-template-columns: 1fr; } }

    .codeBox {
      background: #f6f8f7;
      border: 1px solid #d9e3df;
      border-radius: 12px;
      padding: 10px;
      font-family: ui-monospace, Menlo, Consolas, monospace;
      font-size: 0.95rem;
      word-break: break-all;
      min-height: 44px;
    }

    .modalBtns { display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    .modalBtns .btn { padding: 0.55rem 0.9rem; }

    .qrBox {
      border: 1px solid #d9e3df;
      border-radius: 14px;
      padding: 10px;
      background: #fff;
      display:flex;
      justify-content:center;
    }
    .modalMsg { font-size: 0.92rem; color:#556; margin-top: 8px; white-space: pre-wrap; }

    /* ---------- BOTTOM EXPORT BUTTON ---------- */
    .exportBar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px;
      background: rgba(245,247,246,0.92);
      border-top: 1px solid #e6ece9;
      display:flex;
      justify-content:center;
      z-index: 9000;
      backdrop-filter: blur(6px);
    }
    .exportBar .exportBtn {
      background:#2f5d50;
      color:#fff;
      border:none;
      border-radius: 14px;
      padding: 12px 18px;
      cursor:pointer;
      font-size: 1rem;
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
    }

    /* keep content from hiding behind export bar */
    main { padding-bottom: 90px; }

    @media (max-width: 520px) {
      main { padding-top: 8.5rem; }
    }
  </style>
</head>

<body>
<header>
  <h1>Eco-Responders: After the Fire</h1>
  <div class="small">Prototype ‚Ä¢ auto-save + Resume Code + QR ‚Ä¢ Export My Journal (PDF)</div>
</header>

<!-- TOP-RIGHT PANEL -->
<section class="savePanel" aria-label="Pause and Resume Panel">
  <h4>Pause & Resume</h4>

  <div class="miniRow">
    <button class="miniBtn" id="pauseBtn">Pause & Resume Later</button>
  </div>

  <label for="resumeInput">Resume Code</label>
  <input id="resumeInput" type="text" placeholder="Paste code to resume" />

  <div class="miniRow">
    <button class="miniBtn secondary" id="resumeBtn">Resume</button>
    <button class="miniBtn ghost" id="clearResumeInputBtn">Clear</button>
  </div>

  <div class="status" id="saveStatus">Ready.</div>
</section>

<!-- CENTER MODAL -->
<div class="overlay" id="pauseOverlay" aria-modal="true" role="dialog">
  <div class="modal">
    <h2>Paused! Come back later.</h2>
    <p class="modalSmall">
      Use the <strong>Resume Code</strong> (copy) or the <strong>QR</strong> (scan) to continue on another device.
    </p>

    <div class="modalGrid">
      <div>
        <div class="small"><strong>Resume Code</strong> (copied automatically)</div>
        <div class="codeBox" id="resumeCodeBox"></div>

        <div class="modalBtns">
          <button class="btn" id="copyCodeBtn">Copy Code</button>
          <button class="btn ghost" id="closePauseBtn">Close</button>
        </div>

        <div class="modalMsg" id="modalMsg"></div>
      </div>

      <div>
        <div class="small"><strong>QR Resume Link</strong></div>
        <div class="qrBox"><div id="qrCode"></div></div>
        <div class="small" style="margin-top:8px;">
          Scan to reopen <strong>this lesson</strong> and restore your progress.
        </div>
      </div>
    </div>
  </div>
</div>

<main>
  <div class="card">
    <span class="pill">You can revise</span>
    <p class="small" style="margin:0.5rem 0 0;">
      Your work saves as you type. If you switch devices, use your <strong>Resume Code</strong> or scan the QR.
    </p>
  </div>

  <!-- HOME -->
  <section id="home">
    <h2>Setting the Story</h2>

    <div class="split">
      <div>
        <p>The air smells faintly of pine and smoke, reminders that nature is constantly changing.</p>
        <p>As an Eco-Responder, you‚Äôve learned that every fire tells two stories: one of loss and one of renewal.</p>
        <p>This week, your team is on alert. Just over the ridge, a town called Forest Glen was hit by a wildfire two weeks ago.</p>
        <p>Your town, Maple Valley, sits just downwind.</p>

        <details>
          <summary>What to Expect</summary>
          <p>As an Eco-Responder, your job is to find out how wildfires start, spread, and change habitats.</p>
          <p>You‚Äôll look at real evidence, from NOAA weather data to FEMA field reports, to spot patterns and causes.</p>

          <h3 style="margin-top:0.75rem;">üîç Your Mission</h3>
          <ul>
            <li>Add notes in your Field Journal as you move through each part of the story.</li>
            <li>Use your clues and ideas to make a final plan that helps Maple Valley rebuild safely for both people and wildlife.</li>
            <li>You‚Äôll also make choices that guide what you see and discover along the way.</li>
          </ul>
        </details>

        <details>
          <summary>Mission Glossary: Key Terms to Know</summary>
          <p><strong>üî• Fuel-Moisture</strong><br/>How much water is stored in plants and soil. When it‚Äôs low, leaves and branches dry out and burn more easily.</p>
          <p><strong>üö© Red Flag Warning</strong><br/>A weather alert from NOAA when hot, dry, and windy conditions make wildfires more likely to spread.</p>
          <p><strong>üè† Defensible Space</strong><br/>A safety zone (about 30 feet around a home) kept clear of flammable materials to slow or stop wildfire spread.</p>
          <p><strong>üèó Fire-Resistant Materials</strong><br/>Building materials (like stucco or metal roofs) that don‚Äôt easily burn, protecting homes from embers and heat.</p>
          <p><strong>‚ôª Feedback Loop</strong><br/>When one change causes another that strengthens the first (example: fewer trees ‚Üí hotter ground ‚Üí more fires).</p>
          <p><strong>üåé Ecosystem Recovery</strong><br/>How plants, animals, and soil rebuild after a disturbance like a wildfire.</p>
        </details>

        <div class="row">
          <button class="btn secondary" id="beginMissionBtn">Begin Mission</button>
        </div>
      </div>

      <div class="placeholder">
        Image Placeholder<br/><span class="small">(right side of text)</span>
      </div>
    </div>
  </section>

  <!-- MISSION START -->
  <section id="missionStart" class="hidden">
    <div class="split">
      <div class="placeholder">Image Placeholder<br/><span class="small">(left side)</span></div>

      <div>
        <h2>Ping! Ping! Ping!</h2>
        <p>Your Eco-Responder tablet flashes red.</p>
        <p>Jordan, your FEMA mentor, appears on the screen.</p>
        <p>
          ‚ÄúForest Glen‚Äôs fire is finally contained,‚Äù he says, ‚Äúbut NOAA is warning conditions are still dangerous.
          Maple Valley could be at risk if a new fire starts‚Äîor if winds blow embers toward town.‚Äù
        </p>
        <p><em>"Don't forget to bring your field journal!"</em></p>

        <h3>Where will you begin?</h3>
        <div class="row">
          <button class="btn" id="choiceNoaaBtn">Analyze NOAA Weather Data First</button>
          <button class="btn" id="choiceFieldBtn">Go Straight to the Fire Zone for Field Observation</button>
        </div>

        <div id="choiceFeedback" class="card hidden" style="margin-top: 1rem;"></div>

        <div class="row">
          <button class="btn secondary" id="continueAfterChoiceBtn" disabled>Continue</button>
        </div>
      </div>
    </div>
  </section>

  <!-- NOAA BRANCH -->
  <section id="branchNoaa" class="hidden">
    <h2>NOAA Data Path</h2>
    <p>
      You arrive at the mobile lab, and your tablet connects to NOAA‚Äôs drought archive.
      ‚ÄúSee the trend? Less rain and more heat mean lower fuel moisture,‚Äù Jordan explains.
    </p>

    <h3>Field Journal</h3>
    <p class="small prompt" data-prompt-for="noaa_prediction">
      Predict what might happen to the forest next year if rainfall stays low and temperatures stay high. Use data to support your prediction.
    </p>
    <textarea data-save="noaa_prediction" placeholder="Type your prediction here..."></textarea>

    <div class="row">
      <button class="btn ghost" id="backToStartFromNoaaBtn">Back</button>
    </div>
  </section>

  <!-- FIELD BRANCH -->
  <section id="branchField" class="hidden">
    <div class="split">
      <div class="placeholder">Image Placeholder (left)</div>
      <div>
        <h2>Field Observation Path</h2>
        <p>You ride beside Ranger Marisol into Forest Glen. Your tablet displays photos from Ranger Marisol.</p>

        <h3>Field Journal</h3>
        <p class="small prompt" data-prompt-for="field_observations">
          Record two observations showing how the fire affected people or wildlife.
        </p>
        <textarea data-save="field_observations" placeholder="Observation 1...&#10;Observation 2..."></textarea>

        <hr class="divider" />

        <h3>üå± Mission Challenge (Optional)</h3>
        <p class="small prompt" data-prompt-for="optional_challenge">
          Research a local fire-adapted plant. How does it help stabilize soil or promote regrowth?
        </p>
        <textarea data-save="optional_challenge" placeholder="Optional: type your answer here..."></textarea>

        <div class="row">
          <button class="btn ghost" id="backToStartFromFieldBtn">Back</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script src="app.js"></script>
</main>

<!-- Bottom Export Button -->
<div class="exportBar">
  <button class="exportBtn" id="exportPdfBtn">Export My Journal (PDF)</button>
</div>

</body>
</html>
