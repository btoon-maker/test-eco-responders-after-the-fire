<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eco-Responders: After the Fire (Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; background: #f5f7f6; line-height: 1.6; }
    header { background:#2f5d50; color:#fff; padding: 1.25rem; }
    main { max-width: 980px; margin: 0 auto; background: #fff; padding: 1.5rem; padding-bottom: 7rem; }

    h1,h2,h3 { margin-top: 0; color:#1f3b34; }
    .small { font-size: 0.92rem; color:#455; }
    .pill { display:inline-block; padding: 0.15rem 0.55rem; border-radius: 999px; background:#dfece7; color:#2f5d50; font-size: 0.85rem; }

    .card {
      background:#eef5f2;
      border-left: 5px solid #2f5d50;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 12px;
    }

    .row { display:flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 0.75rem; align-items: center; }

    .btn {
      background:#2f5d50; color:#fff; border:none; padding:0.6rem 1rem; border-radius:10px; cursor:pointer;
      font-size:1rem; font-weight: 900;
    }
    .btn.secondary { background:#405a53; }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 0.75rem;
      border-radius: 12px;
      border: 1px solid #cfd8d5;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .divider { border: none; border-top: 1px solid #e6ece9; margin: 1.25rem 0; }

    .split { display: grid; grid-template-columns: 1fr; gap: 1rem; align-items: start; }
    @media (min-width: 860px) { .split { grid-template-columns: 1.15fr 0.85fr; } }

    .placeholder {
      border: 2px dashed #cfd8d5;
      background: #fafcfc;
      border-radius: 14px;
      min-height: 220px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#667;
      padding: 1rem;
      text-align:center;
    }

    details {
      background:#fafcfc;
      border: 1px solid #e6ece9;
      border-radius: 12px;
      padding: 0.75rem 0.9rem;
      margin: 0.75rem 0;
    }
    details summary { cursor:pointer; font-weight: 900; color:#1f3b34; }

    /* TOP-RIGHT PANEL (ALWAYS) */
    .savePanel {
      position: fixed;
      top: 12px;
      right: 12px;
      width: 235px;
      max-width: calc(100vw - 24px);
      background: #2c3e50;
      color: #fff;
      border-radius: 14px;
      padding: 10px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
      z-index: 9999;
      font-size: 0.85rem;
    }
    .savePanel h4 { margin: 0 0 8px 0; font-size: 0.95rem; }
    .savePanel .miniBtn {
      width: 100%;
      border: none;
      border-radius: 10px;
      padding: 9px 10px;
      font-size: 0.92rem;
      cursor: pointer;
      background: #16a085;
      color: #fff;
      font-weight: 900;
    }
    .savePanel label { display:block; margin-top: 10px; font-weight: 900; opacity: 0.95; }
    .savePanel input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.22);
      padding: 8px 10px;
      font-size: 0.9rem;
      box-sizing: border-box;
      margin-top: 6px;
      background: rgba(255,255,255,0.10);
      color: #fff;
    }
    .savePanel input::placeholder { color: rgba(255,255,255,0.65); }
    .savePanel .twoBtns { display:flex; gap: 8px; margin-top: 8px; }
    .savePanel .smallBtn {
      flex: 1;
      border: none;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.9rem;
      cursor: pointer;
      background: rgba(255,255,255,0.18);
      color: #fff;
      font-weight: 900;
    }
    .savePanel .smallBtn.primary { background:#ffd166; color:#2b2b2b; }
    .savePanel .status { margin-top: 8px; opacity: 0.9; font-size: 0.8rem; white-space: pre-wrap; }

    /* Modal */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 14px;
    }
    .overlay.show { display: flex; }
    .modal {
      width: min(760px, 96vw);
      background: #fff;
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 16px 50px rgba(0,0,0,0.25);
      border: 1px solid #e6ece9;
    }
    .modal h2 { margin: 0 0 6px 0; color:#1f3b34; }
    .modal .hint { margin: 0 0 12px 0; color:#455; font-size: 0.95rem; }
    .modal .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 12px; }
    @media (max-width: 820px){ .modal .grid { grid-template-columns: 1fr; } }
    .codeBox {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #cfd8d5;
      padding: 10px 12px;
      font-size: 0.95rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: #fafcfc;
      box-sizing: border-box;
      word-break: break-all;
    }
    .btnRow { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .btnPrimary { background:#2f5d50; color:#fff; border:none; padding: 10px 12px; border-radius: 12px; cursor:pointer; font-weight: 900; }
    .btnSecondary { background: transparent; color:#2f5d50; border: 1px solid #2f5d50; padding: 10px 12px; border-radius: 12px; cursor:pointer; font-weight: 900; }
    .btnDanger { background: #b42318; color:#fff; border:none; padding: 10px 12px; border-radius: 12px; cursor:pointer; font-weight: 900; }
    .qrWrapModal { border: 1px solid #e6ece9; border-radius: 14px; padding: 10px; background: #fafcfc; }
    #qrCodeModal { display:flex; justify-content:center; }
    .qrHintModal { margin-top: 8px; text-align:center; font-size: 0.9rem; color:#455; }
    .modalStatus { margin-top: 10px; font-size: 0.92rem; color:#455; white-space: pre-wrap; }

    /* Bottom sticky Export */
    .bottomBar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9000;
      background: rgba(255,255,255,0.94);
      backdrop-filter: blur(6px);
      border-top: 1px solid #e6ece9;
      padding: 10px 12px;
    }
    .bottomBar .inner {
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .exportBtn {
      background:#2f5d50;
      color:#fff;
      border:none;
      padding: 10px 14px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 900;
      font-size: 1rem;
    }
    .exportMsg { font-size: 0.9rem; color:#455; margin: 0; }

    @media (max-width: 520px) { main { padding-top: 7.25rem; } }
  </style>
</head>

<body>
<header>
  <h1>Eco-Responders: After the Fire</h1>
  <div class="small">Prototype ‚Ä¢ saves progress ‚Ä¢ Resume Code + QR</div>
</header>

<!-- TOP-RIGHT PANEL -->
<section class="savePanel" aria-label="Pause and Resume Panel">
  <h4>Pause</h4>
  <button type="button" class="miniBtn" id="pauseResumeBtn">Pause & Resume Later</button>

  <label for="resumeInputTop">Paste Resume Code</label>
  <input id="resumeInputTop" type="text" placeholder="Paste code here..." />

  <div class="twoBtns">
    <button type="button" class="smallBtn primary" id="resumeTopBtn">Resume</button>
    <button type="button" class="smallBtn" id="clearTopBtn">Clear</button>
  </div>

  <div class="status" id="saveStatus">Ready.</div>
</section>

<!-- MODAL -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Pause and Resume Later">
    <h2>Pause & Resume Later</h2>
    <p class="hint">Use the QR (best) or copy the Resume Code. You can return on another device.</p>

    <div class="grid">
      <div>
        <div class="codeBox" id="resumeCodeBox"></div>

        <div class="btnRow">
          <button type="button" class="btnPrimary" id="copyCodeBtn">Copy Code</button>
          <button type="button" class="btnSecondary" id="closeModalBtn">Close</button>
          <button type="button" class="btnDanger" id="resetBtn">Reset</button>
        </div>

        <div class="modalStatus" id="modalStatus"></div>
      </div>

      <div class="qrWrapModal">
        <div id="qrCodeModal"></div>
        <div class="qrHintModal">Scan to open the lesson and restore progress.</div>
      </div>
    </div>
  </div>
</div>

<main>
  <div class="card">
    <span class="pill">You can revise</span>
    <p class="small" style="margin:0.5rem 0 0;">
      Your work saves as you type. If you switch devices, use your <strong>Resume Code</strong> or scan the QR.
    </p>
  </div>

  <!-- Story renders here -->
  <div id="story"></div>

  <!-- Templates MUST exist before app.js runs -->
  <template id="tpl-setting">
    <section id="setting">
      <h2>Setting the Story</h2>

      <div class="split">
        <div>
          <p>The air smells faintly of pine and smoke, reminders that nature is constantly changing.</p>
          <p>As an Eco-Responder, you‚Äôve learned that every fire tells two stories: one of loss and one of renewal.</p>
          <p>This week, your team is on alert. Just over the ridge, a town called Forest Glen was hit by a wildfire two weeks ago.</p>
          <p>Your town, Maple Valley, sits just downwind.</p>

          <details>
            <summary>What to Expect</summary>
            <p>As an Eco-Responder, your job is to find out how wildfires start, spread, and change habitats.</p>
            <p>You‚Äôll look at real evidence, from NOAA weather data to FEMA field reports, to spot patterns and causes.</p>

            <h3 style="margin-top:0.75rem;">üîç Your Mission</h3>
            <ul>
              <li>Add notes in your Field Journal as you move through each part of the story.</li>
              <li>Use your clues and ideas to make a final plan that helps Maple Valley rebuild safely for both people and wildlife.</li>
              <li>You‚Äôll also make choices that guide what you see and discover along the way.</li>
            </ul>

            <p>You will encounter two kinds of challenges:</p>
            <p><strong>üî¨ Think Like a Scientist</strong> (found inside your Field Journal)</p>
            <p><strong>üå± Mission Challenges</strong> (optional deeper dives inside the mission)</p>
          </details>

          <details>
            <summary>Mission Glossary: Key Terms to Know</summary>
            <p><strong>üî• Fuel-Moisture</strong><br/>How much water is stored in plants and soil. When it‚Äôs low, leaves and branches dry out and burn more easily.</p>
            <p><strong>üö© Red Flag Warning</strong><br/>A weather alert from NOAA when hot, dry, and windy conditions make wildfires more likely to spread.</p>
            <p><strong>üè† Defensible Space</strong><br/>A safety zone (about 30 feet around a home) kept clear of flammable materials to slow or stop wildfire spread.</p>
            <p><strong>üèó Fire-Resistant Materials</strong><br/>Building materials (like stucco or metal roofs) that don‚Äôt easily burn, protecting homes from embers and heat.</p>
            <p><strong>‚ôª Feedback Loop</strong><br/>When one change causes another that strengthens the first (example: fewer trees ‚Üí hotter ground ‚Üí more fires).</p>
            <p><strong>üåé Ecosystem Recovery</strong><br/>How plants, animals, and soil rebuild after a disturbance like a wildfire.</p>
            <p><strong>üèõ FEMA</strong><br/>The agency that helps people and communities prepare for and recover from natural disasters.</p>
            <p><strong>‚òÅ NOAA</strong><br/>The agency that studies Earth‚Äôs weather and climate to help predict and prevent environmental hazards.</p>
          </details>

          <div class="row">
            <button type="button" class="btn secondary" id="beginMissionBtn">Begin Mission</button>
          </div>
        </div>

        <div class="placeholder" aria-label="Image placeholder">
          Image Placeholder<br/><span class="small">(right side of text)</span>
        </div>
      </div>

      <hr class="divider" />
    </section>
  </template>

  <template id="tpl-call">
    <section id="call">
      <div class="split">
        <div class="placeholder" aria-label="Image placeholder">
          Image Placeholder<br/><span class="small">(left side)</span>
        </div>

        <div>
          <h2>The Call</h2>
          <h3>Ping! Ping! Ping!</h3>
          <p>Your Eco-Responder tablet flashes red.</p>
          <p>Jordan, your FEMA mentor, appears on the screen.</p>
          <p>
            ‚ÄúForest Glen‚Äôs fire is finally contained,‚Äù he says, ‚Äúbut NOAA is warning conditions are still dangerous.
            Maple Valley could be at risk if a new fire starts‚Äîor if winds blow embers toward town.‚Äù
          </p>
          <p><em>"Don't forget to bring your field journal!"</em></p>

          <h3>Where will you begin?</h3>
          <div class="row">
            <button type="button" class="btn" id="choiceNoaaBtn">Analyze NOAA Weather Data First</button>
            <button type="button" class="btn" id="choiceFieldBtn">Go Straight to the Fire Zone for Field Observation</button>
          </div>

          <div id="choiceFeedback" class="card" style="margin-top: 1rem; display:none;"></div>

          <hr class="divider" />
        </div>
      </div>
    </section>
  </template>

  <template id="tpl-noaa">
    <section id="noaa">
      <h2>NOAA Data Path</h2>
      <p>
        You arrive at the mobile lab, and your tablet connects to NOAA‚Äôs drought archive.
        ‚ÄúSee the trend? Less rain and more heat mean lower fuel moisture,‚Äù Jordan explains. ‚ÄúThat‚Äôs a dangerous mix.
        The plants themselves become fuel.‚Äù
      </p>
      <p>With your data uploaded, you now need to understand the field conditions.</p>

      <div class="placeholder" aria-label="Image placeholder" style="min-height:180px; margin: 0.75rem 0;">
        Image Placeholder (below text)
      </div>

      <h3>Field Journal</h3>
      <p class="small"><strong>Prompt:</strong> Predict what might happen to the forest next year if rainfall stays low and temperatures stay high. Use data to support your prediction.</p>
      <textarea data-save="noaa_prediction" placeholder="Type your prediction here..."></textarea>

      <hr class="divider" />

      <h3>‚ö° Mission Challenge (Optional)</h3>
      <p class="small"><strong>Prompt:</strong> Add one more prediction OR one question you want to investigate next.</p>
      <textarea data-save="noaa_mission_challenge" placeholder="Optional: type here..."></textarea>

      <hr class="divider" />
    </section>
  </template>

  <template id="tpl-field">
    <section id="field">
      <div class="split">
        <div class="placeholder" aria-label="Image placeholder">
          Image Placeholder (left)
        </div>
        <div>
          <h2>Field Observation Path</h2>
          <p>
            You ride beside Ranger Marisol into Forest Glen. Your tablet displays photos from Ranger Marisol.
          </p>
          <p>In the photos, you notice:</p>
          <ul>
            <li>Soil dry and crumbly, the organic layer burned away.</li>
            <li>Green shoots pushing through ash.</li>
            <li>Metal-roofed homes still standing; wood roofs gone.</li>
          </ul>
          <p>
            ‚ÄúSoil‚Äôs dry,‚Äù she says. ‚ÄúThin ash layer, but look, some pine cones cracked open.‚Äù
            You examine one: resin melted, seeds spilled onto the ground.
          </p>
          <p>‚ÄúSerotinous cones,‚Äù she explains. ‚ÄúSome trees need heat to start over.‚Äù</p>

          <h3>Field Journal</h3>
          <p class="small"><strong>Prompt:</strong> Record two observations showing how the fire affected people or wildlife.</p>
          <textarea data-save="field_observations" placeholder="Observation 1...&#10;Observation 2..."></textarea>

          <hr class="divider" />

          <h3>üå± Mission Challenge (Optional)</h3>
          <p class="small">Research a local fire-adapted plant. How does it help stabilize soil or promote regrowth?</p>
          <textarea data-save="optional_challenge" placeholder="Optional: type your answer here..."></textarea>

          <hr class="divider" />

          <h3>‚ö° Mission Challenge (Optional)</h3>
          <p class="small"><strong>Prompt:</strong> Add one more observation you think matters most, and explain why.</p>
          <textarea data-save="field_mission_challenge" placeholder="Optional: type here..."></textarea>

          <hr class="divider" />
        </div>
      </div>
    </section>
  </template>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- IMPORTANT: app.js LAST, after templates exist -->
  <script src="app.js"></script>
</main>

<div class="bottomBar" aria-label="Export bar">
  <div class="inner">
    <button type="button" class="exportBtn" id="exportPdfBtn">Export My Journal</button>
    <p class="exportMsg" id="exportMsg">Exports your choices + all written answers as a PDF.</p>
  </div>
</div>
</body>
</html>
